<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Cliff Shed — Event Structure (Conflict) Dual View</title>
<link rel="stylesheet" href="../../common.css"/>
<style>
  :root {
    --bg: #0b1020;
    --panel: #111a33;
    --panel2: #0f1730;
    --text: #e7ecff;
    --muted: #a9b3d6;
    --line: rgba(255,255,255,0.18);
    --accent: #7aa2ff;
    --danger: #ff6b6b;
    --ok: #7dffb2;
    --rope: #7aa2ff;
    --scaff: #6dff7a;
    --heli: #ffb36d;
    --none: #c8d0ff;
  }
  html, body { height: 100%; margin: 0; background: var(--bg); color: var(--text); font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial; }
  .wrap { display: flex; flex-direction: column; height: 100%; }
  header {
    padding: 14px 16px;
    border-bottom: 1px solid rgba(255,255,255,0.12);
    background: linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0));
  }
  header .title { font-size: 18px; font-weight: 700; letter-spacing: 0.2px; }
  header .subtitle { font-size: 13px; color: var(--muted); margin-top: 4px; max-width: 1100px; line-height: 1.35; }
  header .row { display:flex; gap: 10px; flex-wrap: wrap; margin-top: 10px; }
  .btn {
    background: rgba(255,255,255,0.08);
    color: var(--text);
    border: 1px solid rgba(255,255,255,0.12);
    border-radius: 10px;
    padding: 7px 10px;
    font-size: 12px;
    cursor: pointer;
    user-select: none;
  }
  .btn:hover { background: rgba(255,255,255,0.12); }
  .btn.primary { border-color: rgba(122,162,255,0.6); }
  .btn.danger { border-color: rgba(255,107,107,0.55); }
  .btn.toggle-on { background: rgba(255,255,255,0.16); }
  .main { display: flex; gap: 12px; padding: 12px; flex: 1; min-height: 0; }
  .col { display:flex; flex-direction: column; flex: 1; min-width: 0; gap: 10px; }
  .panel {
    background: rgba(255,255,255,0.04);
    border: 1px solid rgba(255,255,255,0.10);
    border-radius: 14px;
    overflow: hidden;
    display:flex;
    flex-direction: column;
    min-height: 0;
  }
  .panel-header {
    padding: 10px 12px;
    background: rgba(255,255,255,0.04);
    border-bottom: 1px solid rgba(255,255,255,0.08);
    display:flex; align-items:center; justify-content: space-between;
    gap: 10px; flex-wrap: wrap;
  }
  .panel-header .h {
    font-size: 13px; font-weight: 700;
  }
  .panel-header .hint {
    font-size: 12px; color: var(--muted);
  }
  .panel-body {
    position: relative;
    flex: 1; min-height: 0;
    background: rgba(0,0,0,0.15);
  }
  .scroll {
    width:100%; height:100%;
    overflow: auto;
  }
  svg {
    display:block;
  }
  .legend { display:flex; gap: 10px; flex-wrap: wrap; font-size: 11px; color: var(--muted); }
  .chip { display:flex; align-items:center; gap: 6px; }
  .dot { width:10px; height:10px; border-radius: 50%; background: var(--muted); }
  .dot.rope { background: var(--rope); }
  .dot.scaff { background: var(--scaff); }
  .dot.heli { background: var(--heli); }
  .dot.base { background: var(--none); }
  .dot.conflict { background: var(--danger); }
  .inspector {
    background: rgba(255,255,255,0.04);
    border: 1px solid rgba(255,255,255,0.10);
    border-radius: 14px;
    padding: 10px 12px;
    height: 210px;
    overflow:auto;
  }
  .inspector h3 { margin: 0 0 6px 0; font-size: 13px; }
  .inspector .muted { color: var(--muted); font-size: 12px; line-height: 1.35; }
  .grid2 { display:grid; grid-template-columns: 1fr 1fr; gap: 10px; }
  .kv { font-size: 12px; line-height: 1.35; }
  .kv b { color: var(--text); }
  .pill {
    display:inline-block; padding: 2px 7px; border-radius: 999px;
    border: 1px solid rgba(255,255,255,0.15);
    background: rgba(255,255,255,0.06);
    font-size: 11px; color: var(--muted);
  }
  .pill.rope { border-color: rgba(122,162,255,0.55); color: var(--rope); }
  .pill.scaff { border-color: rgba(109,255,122,0.55); color: var(--scaff); }
  .pill.heli { border-color: rgba(255,179,109,0.55); color: var(--heli); }
  .pill.none { border-color: rgba(200,208,255,0.35); color: var(--none); }

  /* SVG styling */
  .edge { stroke: rgba(255,255,255,0.22); stroke-width: 1.2; fill: none; }
  .edge.dim { opacity: 0.15; }
  .edge.highlight { stroke: var(--accent); stroke-width: 2.4; opacity: 1; }
  .edgeG { stroke: rgba(255,255,255,0.22); stroke-width: 1.0; fill:none; marker-end:url(#arrow); }
  .edgeG.dim { opacity: 0.12; }
  .edgeG.highlight { stroke: var(--accent); stroke-width: 2.6; opacity: 1; }

  .conflictEdge { stroke: rgba(255,107,107,0.75); stroke-width: 2.0; fill:none; }
  .conflictEdge.implied { stroke-dasharray: 4 6; stroke-width: 1.4; opacity: 0.35; }
  .conflictEdge.hidden { display:none; }

  .node { cursor: pointer; }
  .node circle { stroke: rgba(255,255,255,0.18); stroke-width: 1.2; fill: rgba(255,255,255,0.10); }
  .node.base circle { fill: rgba(200,208,255,0.12); }
  .node.rope circle { fill: rgba(122,162,255,0.14); }
  .node.scaff circle { fill: rgba(109,255,122,0.14); }
  .node.heli circle { fill: rgba(255,179,109,0.14); }
  .node.choice circle { fill: rgba(255,255,255,0.10); stroke: rgba(255,107,107,0.35); }
  .node text { font-size: 11px; fill: rgba(231,236,255,0.92); dominant-baseline: middle; }
  .node .sub { font-size: 10px; fill: rgba(231,236,255,0.70); }
  .node.dim { opacity: 0.18; }
  .node.selected circle { stroke: var(--accent); stroke-width: 3.0; }
  .node.past circle { stroke: rgba(122,162,255,0.55); stroke-width: 2.0; }
  .node.conflict circle { stroke: rgba(255,107,107,0.75); stroke-width: 2.4; }
  .node.inState circle { stroke: rgba(125,255,178,0.65); stroke-width: 2.4; }
  .node.enabled circle { stroke: rgba(125,255,178,0.95); stroke-width: 3.0; }

  .stateNode circle { fill: rgba(255,255,255,0.10); }
  .stateNode.none circle { fill: rgba(200,208,255,0.12); }
  .stateNode.rope circle { fill: rgba(122,162,255,0.12); }
  .stateNode.scaff circle { fill: rgba(109,255,122,0.12); }
  .stateNode.heli circle { fill: rgba(255,179,109,0.12); }

  .stateNode text { font-size: 10px; fill: rgba(231,236,255,0.92); dominant-baseline: middle; }
  .stateNode.dim { opacity: 0.16; }
  .stateNode.selected circle { stroke: var(--accent); stroke-width: 3.0; }
  .stateNode.Ftarget circle { stroke: rgba(122,162,255,0.95); stroke-width: 3.0; }
  .stateNode.enableTarget circle { stroke: rgba(125,255,178,0.95); stroke-width: 3.0; }

  .edgeLabel { font-size: 10px; fill: rgba(231,236,255,0.70); pointer-events:none; }
  .edgeLabel.hidden { display:none; }

  /* modal */
  .modalOverlay {
    position: fixed; inset: 0;
    background: rgba(0,0,0,0.65);
    display:none;
    align-items: center; justify-content: center;
    z-index: 1000;
    padding: 18px;
  }
  .modal {
    max-width: 860px;
    width: 100%;
    background: rgba(17,26,51,0.98);
    border: 1px solid rgba(255,255,255,0.14);
    border-radius: 16px;
    box-shadow: 0 14px 50px rgba(0,0,0,0.45);
    overflow: hidden;
  }
  .modalHeader {
    padding: 12px 14px;
    border-bottom: 1px solid rgba(255,255,255,0.10);
    display:flex; justify-content: space-between; align-items: center; gap: 12px;
  }
  .modalHeader .t { font-weight: 800; font-size: 13px; }
  .modalBody { padding: 12px 14px; color: rgba(231,236,255,0.92); font-size: 12.5px; line-height: 1.45; }
  .modalBody code { color: #d6ddff; background: rgba(255,255,255,0.06); padding: 1px 5px; border-radius: 6px; }
  .modalBody ul, .modalBody ol { margin-top: 6px; }
  .modalClose { cursor:pointer; font-size: 12px; color: var(--muted); }
  .modalClose:hover { color: var(--text); }
</style>
</head>
<body>
<p><a href="../../index.html">Back to app index</a></p>
<div class="wrap">
  <header>
    <div class="title">Cliff shed build — <span style="color:var(--danger)">conflict-aware</span> dual view (prime event structure → configuration category)</div>
    <div class="subtitle">
      Same interaction pattern as your previous app, but the left side is now an <b>event structure</b> with <b>mutually exclusive alternatives</b> (rope vs scaffold vs helicopter).
      The right side is the category of <b>configurations</b>: down-closed <i>and</i> conflict-free states ordered by inclusion.
    </div>
    <div class="row">
      <div class="btn primary" onclick="openExplain('how_to')">How to use this view</div>
      <div class="btn" onclick="openExplain('new_vs_old')">What changed</div>
      <div class="btn" onclick="openExplain('pes_101')">Event structure 101</div>
      <div class="btn" onclick="openExplain('heredity')">Conflict heredity</div>
      <div class="btn" onclick="openExplain('config_def')">Configuration definition</div>
      <div class="btn" onclick="openExplain('enabled')">Enabled events</div>
      <div class="btn" onclick="openExplain('commitments')">Decision commitments</div>
      <div class="btn" onclick="openExplain('joins')">Why joins are hard</div>
      <div class="btn" onclick="openExplain('functors')">F and G under conflict</div>
      <div class="btn" onclick="openExplain('variation')">variation</div>
    </div>
  </header>

  <div class="main">
    <div class="col">
      <div class="panel">
        <div class="panel-header">
          <div>
            <div class="h">Event structure view: <span class="pill">E, ≤, #</span></div>
            <div class="hint">Directed edges = prerequisites (≤). Red edges = conflicts (#) between access methods (toggle implied conflicts if you dare).</div>
          </div>
          <div style="display:flex; gap:8px; flex-wrap: wrap; align-items:center;">
            <div class="btn danger" id="btnImplied" onclick="toggleImpliedConflicts()">Implied conflicts: OFF</div>
            <div class="btn" onclick="clearSelection()">Clear selection</div>
          </div>
        </div>
        <div class="panel-body">
          <div class="scroll">
            <svg id="svgEvents" width="2100" height="650" viewBox="0 0 2100 650">
              <defs>
                <marker id="arrow2" viewBox="0 0 10 10" refX="9" refY="5" markerWidth="7" markerHeight="7" orient="auto-start-reverse">
                  <path d="M 0 0 L 10 5 L 0 10 z" fill="rgba(255,255,255,0.55)"></path>
                </marker>
              </defs>
              <g id="eventEdges"></g>
              <g id="conflictEdgesBase"></g>
              <g id="conflictEdgesImplied" style="display:none;"></g>
              <g id="eventNodes"></g>
            </svg>
          </div>
        </div>
      </div>
      <div class="panel" style="padding: 10px 12px;">
        <div class="legend">
          <div class="chip"><span class="dot base"></span>base</div>
          <div class="chip"><span class="dot rope"></span>rope branch</div>
          <div class="chip"><span class="dot scaff"></span>scaffold branch</div>
          <div class="chip"><span class="dot heli"></span>helicopter branch</div>
          <div class="chip"><span class="dot conflict"></span>conflict edge</div>
          <div class="chip"><span class="pill">click nodes</span> to cross-highlight F(e) and G(e)</div>
        </div>
      </div>
    </div>

    <div class="col">
      <div class="panel">
        <div class="panel-header">
          <div>
            <div class="h">Configuration category: <span class="pill">Cfg(E,≤,#), ⊆</span></div>
            <div class="hint">Nodes = conflict-free down-closed histories. Arrows = add one enabled event (cover edges). Node colour = commitment (none / heli / rope / scaffold).</div>
          </div>
          <div style="display:flex; gap:8px; flex-wrap: wrap; align-items:center;">
            <div class="btn" id="btnLabels" onclick="toggleEdgeLabels()">Edge labels: ON</div>
            <div class="btn" id="btnShowAllMorph" onclick="toggleAllInclusions()">All inclusions: OFF</div>
            <div class="btn" onclick="downloadJSON()">Download JSON</div>
          </div>
        </div>
        <div class="panel-body">
          <div class="scroll">
            <svg id="svgStates" width="1400" height="1220" viewBox="0 0 1400 1220">
              <defs>
                <marker id="arrow" viewBox="0 0 10 10" refX="9" refY="5" markerWidth="7" markerHeight="7" orient="auto-start-reverse">
                  <path d="M 0 0 L 10 5 L 0 10 z" fill="rgba(255,255,255,0.55)"></path>
                </marker>
              </defs>
              <g id="stateEdgesAll" style="display:none;"></g>
              <g id="stateEdges"></g>
              <g id="stateEdgeLabels"></g>
              <g id="stateNodes"></g>
            </svg>
          </div>
        </div>
      </div>
      <div class="inspector" id="inspector">
        <h3>Inspector</h3>
        <div class="muted">Click an event or a state. This panel explains conflicts/commitments and shows the F and G mappings for the selection.</div>
      </div>
    </div>
  </div>

</div>

<!-- Modal -->
<div class="modalOverlay" id="modalOverlay" onclick="closeModalIfBackdrop(event)">
  <div class="modal" onclick="event.stopPropagation()">
    <div class="modalHeader">
      <div class="t" id="modalTitle">Title</div>
      <div class="modalClose" onclick="closeModal()">Close ✕</div>
    </div>
    <div class="modalBody" id="modalBody"></div>
  </div>
</div>

<script>
const DATA = {"meta": {"title": "Cliff Shed \u2014 Prime Event Structure (causality + conflict) and Configuration Category", "scenario": "Build a shed halfway up a cliff. The model includes mutually exclusive access methods (rope vs scaffold vs helicopter), represented as conflict (#) in a prime event structure.", "notes": ["This is a prime event structure (E, \u2264, #) where \u2264 is causal prerequisite and # is symmetric, irreflexive, hereditary conflict.", "States/configurations are down-closed AND conflict-free sets of events.", "The state category is the poset category (Cfg, \u2286).", "Functor F maps each event e to its principal configuration \u2193e (its causal past plus itself).", "Functor G maps each event e to the arrow pre(e) \u2192 pre(e)\u222a{e} in Arr(S), where pre(e)=\u2193e\\{e}."]}, "event_structure": {"events": [{"id": "PERM", "name": "Permissions & landowner sign\u2011off", "desc": "Secure permissions/landowner approval (and any neighbour/stakeholder sign\u2011off) to work and transport materials to the cliff site.", "prereq": [], "branch": "base", "level": 0, "x": 80, "y": 80, "ancestors": [], "conflicts": []}, {"id": "SAFETY", "name": "Safety plan (RAMS) & rescue", "desc": "Working\u2011at\u2011height method statement, rescue plan, communications, PPE, exclusion zones, and emergency access arrangements.", "prereq": [], "branch": "base", "level": 0, "x": 80, "y": 130, "ancestors": [], "conflicts": []}, {"id": "SURV", "name": "Site survey & cliff assessment", "desc": "Measure the bench location, check slope stability/rock quality, identify anchorable rock, drainage paths, and a safe working envelope.", "prereq": ["PERM", "SAFETY"], "branch": "base", "level": 1, "x": 260, "y": 80, "ancestors": ["PERM", "SAFETY"], "conflicts": []}, {"id": "DES", "name": "Shed design & bill of materials", "desc": "Choose shed dimensions, framing scheme, wind loads, fixings, and compile bill of materials sized for the chosen site geometry.", "prereq": ["SURV"], "branch": "base", "level": 2, "x": 440, "y": 80, "ancestors": ["PERM", "SAFETY", "SURV"], "conflicts": []}, {"id": "ORDER", "name": "Order materials & anchors", "desc": "Order timber/panels, fixings, roofing, cladding, and anchors/fasteners suitable for the exposed cliff environment.", "prereq": ["DES"], "branch": "base", "level": 3, "x": 620, "y": 80, "ancestors": ["PERM", "SAFETY", "SURV", "DES"], "conflicts": []}, {"id": "ACC_ROPE", "name": "Access set\u2011up: rope access", "desc": "Rig rope access: install temporary edge protection where possible, rig main and safety lines, set work positioning for the build area.", "prereq": ["SURV"], "branch": "choice_rope", "choice_group": "ACCESS_METHOD", "level": 2, "x": 440, "y": 230, "ancestors": ["PERM", "SAFETY", "SURV"], "conflicts": ["ACC_HELI", "ACC_SCAFF", "STAGE_HELI", "STAGE_SCAFF", "TERR_HELI", "TERR_SCAFF", "FOUND_HELI", "FOUND_SCAFF", "FRAME_HELI", "FRAME_SCAFF", "ROOF_HELI", "ROOF_SCAFF", "CLAD_HELI", "CLAD_SCAFF", "HAND_HELI", "HAND_SCAFF"]}, {"id": "ACC_SCAFF", "name": "Access set\u2011up: scaffold / walkway", "desc": "Erect scaffold or a temporary walkway/working platform to reach and work at the bench safely; include edge protection.", "prereq": ["SURV"], "branch": "choice_scaff", "choice_group": "ACCESS_METHOD", "level": 2, "x": 440, "y": 280, "ancestors": ["PERM", "SAFETY", "SURV"], "conflicts": ["ACC_HELI", "ACC_ROPE", "STAGE_HELI", "STAGE_ROPE", "TERR_HELI", "TERR_ROPE", "FOUND_HELI", "FOUND_ROPE", "FRAME_HELI", "FRAME_ROPE", "ROOF_HELI", "ROOF_ROPE", "CLAD_HELI", "CLAD_ROPE", "HAND_HELI", "HAND_ROPE"]}, {"id": "ACC_HELI", "name": "Access set\u2011up: helicopter lift plan", "desc": "Execute a helicopter lift plan (or equivalent aerial lift) to move materials to the bench; establish drop/staging controls.", "prereq": ["SURV"], "branch": "choice_heli", "choice_group": "ACCESS_METHOD", "level": 2, "x": 440, "y": 180, "ancestors": ["PERM", "SAFETY", "SURV"], "conflicts": ["ACC_ROPE", "ACC_SCAFF", "STAGE_ROPE", "STAGE_SCAFF", "TERR_ROPE", "TERR_SCAFF", "FOUND_ROPE", "FOUND_SCAFF", "FRAME_ROPE", "FRAME_SCAFF", "ROOF_ROPE", "ROOF_SCAFF", "CLAD_ROPE", "CLAD_SCAFF", "HAND_ROPE", "HAND_SCAFF"]}, {"id": "STAGE_ROPE", "name": "Stage materials (rope access)", "desc": "Move/haul materials to the bench and stage them at the work area using the rope access access method.", "prereq": ["ORDER", "ACC_ROPE"], "branch": "rope", "level": 4, "x": 800, "y": 300, "ancestors": ["PERM", "SAFETY", "SURV", "ACC_ROPE", "DES", "ORDER"], "conflicts": ["ACC_HELI", "ACC_SCAFF", "STAGE_HELI", "STAGE_SCAFF", "TERR_HELI", "TERR_SCAFF", "FOUND_HELI", "FOUND_SCAFF", "FRAME_HELI", "FRAME_SCAFF", "ROOF_HELI", "ROOF_SCAFF", "CLAD_HELI", "CLAD_SCAFF", "HAND_HELI", "HAND_SCAFF"]}, {"id": "TERR_ROPE", "name": "Prepare terrace & drainage (rope access)", "desc": "Clear/level the bench, add drainage/erosion control and a stable working surface sized for the shed footprint.", "prereq": ["STAGE_ROPE"], "branch": "rope", "level": 5, "x": 980, "y": 300, "ancestors": ["PERM", "SAFETY", "SURV", "ACC_ROPE", "DES", "ORDER", "STAGE_ROPE"], "conflicts": ["ACC_HELI", "ACC_SCAFF", "STAGE_HELI", "STAGE_SCAFF", "TERR_HELI", "TERR_SCAFF", "FOUND_HELI", "FOUND_SCAFF", "FRAME_HELI", "FRAME_SCAFF", "ROOF_HELI", "ROOF_SCAFF", "CLAD_HELI", "CLAD_SCAFF", "HAND_HELI", "HAND_SCAFF"]}, {"id": "FOUND_ROPE", "name": "Install foundations/anchors (rope access)", "desc": "Install footings/anchors into rock or soil, set levels, and prepare tie\u2011down points for wind uplift.", "prereq": ["TERR_ROPE"], "branch": "rope", "level": 6, "x": 1160, "y": 300, "ancestors": ["PERM", "SAFETY", "SURV", "ACC_ROPE", "DES", "ORDER", "STAGE_ROPE", "TERR_ROPE"], "conflicts": ["ACC_HELI", "ACC_SCAFF", "STAGE_HELI", "STAGE_SCAFF", "TERR_HELI", "TERR_SCAFF", "FOUND_HELI", "FOUND_SCAFF", "FRAME_HELI", "FRAME_SCAFF", "ROOF_HELI", "ROOF_SCAFF", "CLAD_HELI", "CLAD_SCAFF", "HAND_HELI", "HAND_SCAFF"]}, {"id": "FRAME_ROPE", "name": "Frame shed structure (rope access)", "desc": "Assemble base frame and wall framing; ensure square/plumb; fix to foundations/anchors.", "prereq": ["FOUND_ROPE"], "branch": "rope", "level": 7, "x": 1340, "y": 300, "ancestors": ["PERM", "SAFETY", "SURV", "ACC_ROPE", "DES", "ORDER", "STAGE_ROPE", "TERR_ROPE", "FOUND_ROPE"], "conflicts": ["ACC_HELI", "ACC_SCAFF", "STAGE_HELI", "STAGE_SCAFF", "TERR_HELI", "TERR_SCAFF", "FOUND_HELI", "FOUND_SCAFF", "FRAME_HELI", "FRAME_SCAFF", "ROOF_HELI", "ROOF_SCAFF", "CLAD_HELI", "CLAD_SCAFF", "HAND_HELI", "HAND_SCAFF"]}, {"id": "ROOF_ROPE", "name": "Roof & weather\u2011tight shell (rope access)", "desc": "Install roof structure and waterproofing so the shed is weather\u2011tight (critical on exposed sites).", "prereq": ["FRAME_ROPE"], "branch": "rope", "level": 8, "x": 1520, "y": 300, "ancestors": ["PERM", "SAFETY", "SURV", "ACC_ROPE", "DES", "ORDER", "STAGE_ROPE", "TERR_ROPE", "FOUND_ROPE", "FRAME_ROPE"], "conflicts": ["ACC_HELI", "ACC_SCAFF", "STAGE_HELI", "STAGE_SCAFF", "TERR_HELI", "TERR_SCAFF", "FOUND_HELI", "FOUND_SCAFF", "FRAME_HELI", "FRAME_SCAFF", "ROOF_HELI", "ROOF_SCAFF", "CLAD_HELI", "CLAD_SCAFF", "HAND_HELI", "HAND_SCAFF"]}, {"id": "CLAD_ROPE", "name": "Cladding + door/window (rope access)", "desc": "Install cladding, door, and any windows; flashings; windproofing details.", "prereq": ["ROOF_ROPE"], "branch": "rope", "level": 9, "x": 1700, "y": 300, "ancestors": ["PERM", "SAFETY", "SURV", "ACC_ROPE", "DES", "ORDER", "STAGE_ROPE", "TERR_ROPE", "FOUND_ROPE", "FRAME_ROPE", "ROOF_ROPE"], "conflicts": ["ACC_HELI", "ACC_SCAFF", "STAGE_HELI", "STAGE_SCAFF", "TERR_HELI", "TERR_SCAFF", "FOUND_HELI", "FOUND_SCAFF", "FRAME_HELI", "FRAME_SCAFF", "ROOF_HELI", "ROOF_SCAFF", "CLAD_HELI", "CLAD_SCAFF", "HAND_HELI", "HAND_SCAFF"]}, {"id": "HAND_ROPE", "name": "Final inspection & handover (rope access)", "desc": "Final safety/quality inspection, tidy site, remove temporary works where applicable, handover and documentation.", "prereq": ["CLAD_ROPE"], "branch": "rope", "level": 10, "x": 1880, "y": 300, "ancestors": ["PERM", "SAFETY", "SURV", "ACC_ROPE", "DES", "ORDER", "STAGE_ROPE", "TERR_ROPE", "FOUND_ROPE", "FRAME_ROPE", "ROOF_ROPE", "CLAD_ROPE"], "conflicts": ["ACC_HELI", "ACC_SCAFF", "STAGE_HELI", "STAGE_SCAFF", "TERR_HELI", "TERR_SCAFF", "FOUND_HELI", "FOUND_SCAFF", "FRAME_HELI", "FRAME_SCAFF", "ROOF_HELI", "ROOF_SCAFF", "CLAD_HELI", "CLAD_SCAFF", "HAND_HELI", "HAND_SCAFF"]}, {"id": "STAGE_SCAFF", "name": "Stage materials (scaffold / walkway)", "desc": "Move/haul materials to the bench and stage them at the work area using the scaffold / walkway access method.", "prereq": ["ORDER", "ACC_SCAFF"], "branch": "scaff", "level": 4, "x": 800, "y": 420, "ancestors": ["PERM", "SAFETY", "SURV", "ACC_SCAFF", "DES", "ORDER"], "conflicts": ["ACC_HELI", "ACC_ROPE", "STAGE_HELI", "STAGE_ROPE", "TERR_HELI", "TERR_ROPE", "FOUND_HELI", "FOUND_ROPE", "FRAME_HELI", "FRAME_ROPE", "ROOF_HELI", "ROOF_ROPE", "CLAD_HELI", "CLAD_ROPE", "HAND_HELI", "HAND_ROPE"]}, {"id": "TERR_SCAFF", "name": "Prepare terrace & drainage (scaffold / walkway)", "desc": "Clear/level the bench, add drainage/erosion control and a stable working surface sized for the shed footprint.", "prereq": ["STAGE_SCAFF"], "branch": "scaff", "level": 5, "x": 980, "y": 420, "ancestors": ["PERM", "SAFETY", "SURV", "ACC_SCAFF", "DES", "ORDER", "STAGE_SCAFF"], "conflicts": ["ACC_HELI", "ACC_ROPE", "STAGE_HELI", "STAGE_ROPE", "TERR_HELI", "TERR_ROPE", "FOUND_HELI", "FOUND_ROPE", "FRAME_HELI", "FRAME_ROPE", "ROOF_HELI", "ROOF_ROPE", "CLAD_HELI", "CLAD_ROPE", "HAND_HELI", "HAND_ROPE"]}, {"id": "FOUND_SCAFF", "name": "Install foundations/anchors (scaffold / walkway)", "desc": "Install footings/anchors into rock or soil, set levels, and prepare tie\u2011down points for wind uplift.", "prereq": ["TERR_SCAFF"], "branch": "scaff", "level": 6, "x": 1160, "y": 420, "ancestors": ["PERM", "SAFETY", "SURV", "ACC_SCAFF", "DES", "ORDER", "STAGE_SCAFF", "TERR_SCAFF"], "conflicts": ["ACC_HELI", "ACC_ROPE", "STAGE_HELI", "STAGE_ROPE", "TERR_HELI", "TERR_ROPE", "FOUND_HELI", "FOUND_ROPE", "FRAME_HELI", "FRAME_ROPE", "ROOF_HELI", "ROOF_ROPE", "CLAD_HELI", "CLAD_ROPE", "HAND_HELI", "HAND_ROPE"]}, {"id": "FRAME_SCAFF", "name": "Frame shed structure (scaffold / walkway)", "desc": "Assemble base frame and wall framing; ensure square/plumb; fix to foundations/anchors.", "prereq": ["FOUND_SCAFF"], "branch": "scaff", "level": 7, "x": 1340, "y": 420, "ancestors": ["PERM", "SAFETY", "SURV", "ACC_SCAFF", "DES", "ORDER", "STAGE_SCAFF", "TERR_SCAFF", "FOUND_SCAFF"], "conflicts": ["ACC_HELI", "ACC_ROPE", "STAGE_HELI", "STAGE_ROPE", "TERR_HELI", "TERR_ROPE", "FOUND_HELI", "FOUND_ROPE", "FRAME_HELI", "FRAME_ROPE", "ROOF_HELI", "ROOF_ROPE", "CLAD_HELI", "CLAD_ROPE", "HAND_HELI", "HAND_ROPE"]}, {"id": "ROOF_SCAFF", "name": "Roof & weather\u2011tight shell (scaffold / walkway)", "desc": "Install roof structure and waterproofing so the shed is weather\u2011tight (critical on exposed sites).", "prereq": ["FRAME_SCAFF"], "branch": "scaff", "level": 8, "x": 1520, "y": 420, "ancestors": ["PERM", "SAFETY", "SURV", "ACC_SCAFF", "DES", "ORDER", "STAGE_SCAFF", "TERR_SCAFF", "FOUND_SCAFF", "FRAME_SCAFF"], "conflicts": ["ACC_HELI", "ACC_ROPE", "STAGE_HELI", "STAGE_ROPE", "TERR_HELI", "TERR_ROPE", "FOUND_HELI", "FOUND_ROPE", "FRAME_HELI", "FRAME_ROPE", "ROOF_HELI", "ROOF_ROPE", "CLAD_HELI", "CLAD_ROPE", "HAND_HELI", "HAND_ROPE"]}, {"id": "CLAD_SCAFF", "name": "Cladding + door/window (scaffold / walkway)", "desc": "Install cladding, door, and any windows; flashings; windproofing details.", "prereq": ["ROOF_SCAFF"], "branch": "scaff", "level": 9, "x": 1700, "y": 420, "ancestors": ["PERM", "SAFETY", "SURV", "ACC_SCAFF", "DES", "ORDER", "STAGE_SCAFF", "TERR_SCAFF", "FOUND_SCAFF", "FRAME_SCAFF", "ROOF_SCAFF"], "conflicts": ["ACC_HELI", "ACC_ROPE", "STAGE_HELI", "STAGE_ROPE", "TERR_HELI", "TERR_ROPE", "FOUND_HELI", "FOUND_ROPE", "FRAME_HELI", "FRAME_ROPE", "ROOF_HELI", "ROOF_ROPE", "CLAD_HELI", "CLAD_ROPE", "HAND_HELI", "HAND_ROPE"]}, {"id": "HAND_SCAFF", "name": "Final inspection & handover (scaffold / walkway)", "desc": "Final safety/quality inspection, tidy site, remove temporary works where applicable, handover and documentation.", "prereq": ["CLAD_SCAFF"], "branch": "scaff", "level": 10, "x": 1880, "y": 420, "ancestors": ["PERM", "SAFETY", "SURV", "ACC_SCAFF", "DES", "ORDER", "STAGE_SCAFF", "TERR_SCAFF", "FOUND_SCAFF", "FRAME_SCAFF", "ROOF_SCAFF", "CLAD_SCAFF"], "conflicts": ["ACC_HELI", "ACC_ROPE", "STAGE_HELI", "STAGE_ROPE", "TERR_HELI", "TERR_ROPE", "FOUND_HELI", "FOUND_ROPE", "FRAME_HELI", "FRAME_ROPE", "ROOF_HELI", "ROOF_ROPE", "CLAD_HELI", "CLAD_ROPE", "HAND_HELI", "HAND_ROPE"]}, {"id": "STAGE_HELI", "name": "Stage materials (helicopter lift)", "desc": "Move/haul materials to the bench and stage them at the work area using the helicopter lift access method.", "prereq": ["ORDER", "ACC_HELI"], "branch": "heli", "level": 4, "x": 800, "y": 540, "ancestors": ["PERM", "SAFETY", "SURV", "ACC_HELI", "DES", "ORDER"], "conflicts": ["ACC_ROPE", "ACC_SCAFF", "STAGE_ROPE", "STAGE_SCAFF", "TERR_ROPE", "TERR_SCAFF", "FOUND_ROPE", "FOUND_SCAFF", "FRAME_ROPE", "FRAME_SCAFF", "ROOF_ROPE", "ROOF_SCAFF", "CLAD_ROPE", "CLAD_SCAFF", "HAND_ROPE", "HAND_SCAFF"]}, {"id": "TERR_HELI", "name": "Prepare terrace & drainage (helicopter lift)", "desc": "Clear/level the bench, add drainage/erosion control and a stable working surface sized for the shed footprint.", "prereq": ["STAGE_HELI"], "branch": "heli", "level": 5, "x": 980, "y": 540, "ancestors": ["PERM", "SAFETY", "SURV", "ACC_HELI", "DES", "ORDER", "STAGE_HELI"], "conflicts": ["ACC_ROPE", "ACC_SCAFF", "STAGE_ROPE", "STAGE_SCAFF", "TERR_ROPE", "TERR_SCAFF", "FOUND_ROPE", "FOUND_SCAFF", "FRAME_ROPE", "FRAME_SCAFF", "ROOF_ROPE", "ROOF_SCAFF", "CLAD_ROPE", "CLAD_SCAFF", "HAND_ROPE", "HAND_SCAFF"]}, {"id": "FOUND_HELI", "name": "Install foundations/anchors (helicopter lift)", "desc": "Install footings/anchors into rock or soil, set levels, and prepare tie\u2011down points for wind uplift.", "prereq": ["TERR_HELI"], "branch": "heli", "level": 6, "x": 1160, "y": 540, "ancestors": ["PERM", "SAFETY", "SURV", "ACC_HELI", "DES", "ORDER", "STAGE_HELI", "TERR_HELI"], "conflicts": ["ACC_ROPE", "ACC_SCAFF", "STAGE_ROPE", "STAGE_SCAFF", "TERR_ROPE", "TERR_SCAFF", "FOUND_ROPE", "FOUND_SCAFF", "FRAME_ROPE", "FRAME_SCAFF", "ROOF_ROPE", "ROOF_SCAFF", "CLAD_ROPE", "CLAD_SCAFF", "HAND_ROPE", "HAND_SCAFF"]}, {"id": "FRAME_HELI", "name": "Frame shed structure (helicopter lift)", "desc": "Assemble base frame and wall framing; ensure square/plumb; fix to foundations/anchors.", "prereq": ["FOUND_HELI"], "branch": "heli", "level": 7, "x": 1340, "y": 540, "ancestors": ["PERM", "SAFETY", "SURV", "ACC_HELI", "DES", "ORDER", "STAGE_HELI", "TERR_HELI", "FOUND_HELI"], "conflicts": ["ACC_ROPE", "ACC_SCAFF", "STAGE_ROPE", "STAGE_SCAFF", "TERR_ROPE", "TERR_SCAFF", "FOUND_ROPE", "FOUND_SCAFF", "FRAME_ROPE", "FRAME_SCAFF", "ROOF_ROPE", "ROOF_SCAFF", "CLAD_ROPE", "CLAD_SCAFF", "HAND_ROPE", "HAND_SCAFF"]}, {"id": "ROOF_HELI", "name": "Roof & weather\u2011tight shell (helicopter lift)", "desc": "Install roof structure and waterproofing so the shed is weather\u2011tight (critical on exposed sites).", "prereq": ["FRAME_HELI"], "branch": "heli", "level": 8, "x": 1520, "y": 540, "ancestors": ["PERM", "SAFETY", "SURV", "ACC_HELI", "DES", "ORDER", "STAGE_HELI", "TERR_HELI", "FOUND_HELI", "FRAME_HELI"], "conflicts": ["ACC_ROPE", "ACC_SCAFF", "STAGE_ROPE", "STAGE_SCAFF", "TERR_ROPE", "TERR_SCAFF", "FOUND_ROPE", "FOUND_SCAFF", "FRAME_ROPE", "FRAME_SCAFF", "ROOF_ROPE", "ROOF_SCAFF", "CLAD_ROPE", "CLAD_SCAFF", "HAND_ROPE", "HAND_SCAFF"]}, {"id": "CLAD_HELI", "name": "Cladding + door/window (helicopter lift)", "desc": "Install cladding, door, and any windows; flashings; windproofing details.", "prereq": ["ROOF_HELI"], "branch": "heli", "level": 9, "x": 1700, "y": 540, "ancestors": ["PERM", "SAFETY", "SURV", "ACC_HELI", "DES", "ORDER", "STAGE_HELI", "TERR_HELI", "FOUND_HELI", "FRAME_HELI", "ROOF_HELI"], "conflicts": ["ACC_ROPE", "ACC_SCAFF", "STAGE_ROPE", "STAGE_SCAFF", "TERR_ROPE", "TERR_SCAFF", "FOUND_ROPE", "FOUND_SCAFF", "FRAME_ROPE", "FRAME_SCAFF", "ROOF_ROPE", "ROOF_SCAFF", "CLAD_ROPE", "CLAD_SCAFF", "HAND_ROPE", "HAND_SCAFF"]}, {"id": "HAND_HELI", "name": "Final inspection & handover (helicopter lift)", "desc": "Final safety/quality inspection, tidy site, remove temporary works where applicable, handover and documentation.", "prereq": ["CLAD_HELI"], "branch": "heli", "level": 10, "x": 1880, "y": 540, "ancestors": ["PERM", "SAFETY", "SURV", "ACC_HELI", "DES", "ORDER", "STAGE_HELI", "TERR_HELI", "FOUND_HELI", "FRAME_HELI", "ROOF_HELI", "CLAD_HELI"], "conflicts": ["ACC_ROPE", "ACC_SCAFF", "STAGE_ROPE", "STAGE_SCAFF", "TERR_ROPE", "TERR_SCAFF", "FOUND_ROPE", "FOUND_SCAFF", "FRAME_ROPE", "FRAME_SCAFF", "ROOF_ROPE", "ROOF_SCAFF", "CLAD_ROPE", "CLAD_SCAFF", "HAND_ROPE", "HAND_SCAFF"]}], "causal_edges": [{"source": "PERM", "target": "SURV"}, {"source": "SAFETY", "target": "SURV"}, {"source": "SURV", "target": "DES"}, {"source": "DES", "target": "ORDER"}, {"source": "SURV", "target": "ACC_ROPE"}, {"source": "SURV", "target": "ACC_SCAFF"}, {"source": "SURV", "target": "ACC_HELI"}, {"source": "ORDER", "target": "STAGE_ROPE"}, {"source": "ACC_ROPE", "target": "STAGE_ROPE"}, {"source": "STAGE_ROPE", "target": "TERR_ROPE"}, {"source": "TERR_ROPE", "target": "FOUND_ROPE"}, {"source": "FOUND_ROPE", "target": "FRAME_ROPE"}, {"source": "FRAME_ROPE", "target": "ROOF_ROPE"}, {"source": "ROOF_ROPE", "target": "CLAD_ROPE"}, {"source": "CLAD_ROPE", "target": "HAND_ROPE"}, {"source": "ORDER", "target": "STAGE_SCAFF"}, {"source": "ACC_SCAFF", "target": "STAGE_SCAFF"}, {"source": "STAGE_SCAFF", "target": "TERR_SCAFF"}, {"source": "TERR_SCAFF", "target": "FOUND_SCAFF"}, {"source": "FOUND_SCAFF", "target": "FRAME_SCAFF"}, {"source": "FRAME_SCAFF", "target": "ROOF_SCAFF"}, {"source": "ROOF_SCAFF", "target": "CLAD_SCAFF"}, {"source": "CLAD_SCAFF", "target": "HAND_SCAFF"}, {"source": "ORDER", "target": "STAGE_HELI"}, {"source": "ACC_HELI", "target": "STAGE_HELI"}, {"source": "STAGE_HELI", "target": "TERR_HELI"}, {"source": "TERR_HELI", "target": "FOUND_HELI"}, {"source": "FOUND_HELI", "target": "FRAME_HELI"}, {"source": "FRAME_HELI", "target": "ROOF_HELI"}, {"source": "ROOF_HELI", "target": "CLAD_HELI"}, {"source": "CLAD_HELI", "target": "HAND_HELI"}], "conflict_edges_base": [{"a": "ACC_ROPE", "b": "ACC_SCAFF"}, {"a": "ACC_HELI", "b": "ACC_SCAFF"}, {"a": "ACC_HELI", "b": "ACC_ROPE"}], "conflict_edges_full": [{"a": "ACC_HELI", "b": "ACC_ROPE"}, {"a": "ACC_HELI", "b": "ACC_SCAFF"}, {"a": "ACC_HELI", "b": "CLAD_ROPE"}, {"a": "ACC_HELI", "b": "CLAD_SCAFF"}, {"a": "ACC_HELI", "b": "FOUND_ROPE"}, {"a": "ACC_HELI", "b": "FOUND_SCAFF"}, {"a": "ACC_HELI", "b": "FRAME_ROPE"}, {"a": "ACC_HELI", "b": "FRAME_SCAFF"}, {"a": "ACC_HELI", "b": "HAND_ROPE"}, {"a": "ACC_HELI", "b": "HAND_SCAFF"}, {"a": "ACC_HELI", "b": "ROOF_ROPE"}, {"a": "ACC_HELI", "b": "ROOF_SCAFF"}, {"a": "ACC_HELI", "b": "STAGE_ROPE"}, {"a": "ACC_HELI", "b": "STAGE_SCAFF"}, {"a": "ACC_HELI", "b": "TERR_ROPE"}, {"a": "ACC_HELI", "b": "TERR_SCAFF"}, {"a": "ACC_ROPE", "b": "ACC_SCAFF"}, {"a": "ACC_ROPE", "b": "CLAD_HELI"}, {"a": "ACC_ROPE", "b": "CLAD_SCAFF"}, {"a": "ACC_ROPE", "b": "FOUND_HELI"}, {"a": "ACC_ROPE", "b": "FOUND_SCAFF"}, {"a": "ACC_ROPE", "b": "FRAME_HELI"}, {"a": "ACC_ROPE", "b": "FRAME_SCAFF"}, {"a": "ACC_ROPE", "b": "HAND_HELI"}, {"a": "ACC_ROPE", "b": "HAND_SCAFF"}, {"a": "ACC_ROPE", "b": "ROOF_HELI"}, {"a": "ACC_ROPE", "b": "ROOF_SCAFF"}, {"a": "ACC_ROPE", "b": "STAGE_HELI"}, {"a": "ACC_ROPE", "b": "STAGE_SCAFF"}, {"a": "ACC_ROPE", "b": "TERR_HELI"}, {"a": "ACC_ROPE", "b": "TERR_SCAFF"}, {"a": "ACC_SCAFF", "b": "CLAD_HELI"}, {"a": "ACC_SCAFF", "b": "CLAD_ROPE"}, {"a": "ACC_SCAFF", "b": "FOUND_HELI"}, {"a": "ACC_SCAFF", "b": "FOUND_ROPE"}, {"a": "ACC_SCAFF", "b": "FRAME_HELI"}, {"a": "ACC_SCAFF", "b": "FRAME_ROPE"}, {"a": "ACC_SCAFF", "b": "HAND_HELI"}, {"a": "ACC_SCAFF", "b": "HAND_ROPE"}, {"a": "ACC_SCAFF", "b": "ROOF_HELI"}, {"a": "ACC_SCAFF", "b": "ROOF_ROPE"}, {"a": "ACC_SCAFF", "b": "STAGE_HELI"}, {"a": "ACC_SCAFF", "b": "STAGE_ROPE"}, {"a": "ACC_SCAFF", "b": "TERR_HELI"}, {"a": "ACC_SCAFF", "b": "TERR_ROPE"}, {"a": "CLAD_HELI", "b": "CLAD_ROPE"}, {"a": "CLAD_HELI", "b": "CLAD_SCAFF"}, {"a": "CLAD_HELI", "b": "FOUND_ROPE"}, {"a": "CLAD_HELI", "b": "FOUND_SCAFF"}, {"a": "CLAD_HELI", "b": "FRAME_ROPE"}, {"a": "CLAD_HELI", "b": "FRAME_SCAFF"}, {"a": "CLAD_HELI", "b": "HAND_ROPE"}, {"a": "CLAD_HELI", "b": "HAND_SCAFF"}, {"a": "CLAD_HELI", "b": "ROOF_ROPE"}, {"a": "CLAD_HELI", "b": "ROOF_SCAFF"}, {"a": "CLAD_HELI", "b": "STAGE_ROPE"}, {"a": "CLAD_HELI", "b": "STAGE_SCAFF"}, {"a": "CLAD_HELI", "b": "TERR_ROPE"}, {"a": "CLAD_HELI", "b": "TERR_SCAFF"}, {"a": "CLAD_ROPE", "b": "CLAD_SCAFF"}, {"a": "CLAD_ROPE", "b": "FOUND_HELI"}, {"a": "CLAD_ROPE", "b": "FOUND_SCAFF"}, {"a": "CLAD_ROPE", "b": "FRAME_HELI"}, {"a": "CLAD_ROPE", "b": "FRAME_SCAFF"}, {"a": "CLAD_ROPE", "b": "HAND_HELI"}, {"a": "CLAD_ROPE", "b": "HAND_SCAFF"}, {"a": "CLAD_ROPE", "b": "ROOF_HELI"}, {"a": "CLAD_ROPE", "b": "ROOF_SCAFF"}, {"a": "CLAD_ROPE", "b": "STAGE_HELI"}, {"a": "CLAD_ROPE", "b": "STAGE_SCAFF"}, {"a": "CLAD_ROPE", "b": "TERR_HELI"}, {"a": "CLAD_ROPE", "b": "TERR_SCAFF"}, {"a": "CLAD_SCAFF", "b": "FOUND_HELI"}, {"a": "CLAD_SCAFF", "b": "FOUND_ROPE"}, {"a": "CLAD_SCAFF", "b": "FRAME_HELI"}, {"a": "CLAD_SCAFF", "b": "FRAME_ROPE"}, {"a": "CLAD_SCAFF", "b": "HAND_HELI"}, {"a": "CLAD_SCAFF", "b": "HAND_ROPE"}, {"a": "CLAD_SCAFF", "b": "ROOF_HELI"}, {"a": "CLAD_SCAFF", "b": "ROOF_ROPE"}, {"a": "CLAD_SCAFF", "b": "STAGE_HELI"}, {"a": "CLAD_SCAFF", "b": "STAGE_ROPE"}, {"a": "CLAD_SCAFF", "b": "TERR_HELI"}, {"a": "CLAD_SCAFF", "b": "TERR_ROPE"}, {"a": "FOUND_HELI", "b": "FOUND_ROPE"}, {"a": "FOUND_HELI", "b": "FOUND_SCAFF"}, {"a": "FOUND_HELI", "b": "FRAME_ROPE"}, {"a": "FOUND_HELI", "b": "FRAME_SCAFF"}, {"a": "FOUND_HELI", "b": "HAND_ROPE"}, {"a": "FOUND_HELI", "b": "HAND_SCAFF"}, {"a": "FOUND_HELI", "b": "ROOF_ROPE"}, {"a": "FOUND_HELI", "b": "ROOF_SCAFF"}, {"a": "FOUND_HELI", "b": "STAGE_ROPE"}, {"a": "FOUND_HELI", "b": "STAGE_SCAFF"}, {"a": "FOUND_HELI", "b": "TERR_ROPE"}, {"a": "FOUND_HELI", "b": "TERR_SCAFF"}, {"a": "FOUND_ROPE", "b": "FOUND_SCAFF"}, {"a": "FOUND_ROPE", "b": "FRAME_HELI"}, {"a": "FOUND_ROPE", "b": "FRAME_SCAFF"}, {"a": "FOUND_ROPE", "b": "HAND_HELI"}, {"a": "FOUND_ROPE", "b": "HAND_SCAFF"}, {"a": "FOUND_ROPE", "b": "ROOF_HELI"}, {"a": "FOUND_ROPE", "b": "ROOF_SCAFF"}, {"a": "FOUND_ROPE", "b": "STAGE_HELI"}, {"a": "FOUND_ROPE", "b": "STAGE_SCAFF"}, {"a": "FOUND_ROPE", "b": "TERR_HELI"}, {"a": "FOUND_ROPE", "b": "TERR_SCAFF"}, {"a": "FOUND_SCAFF", "b": "FRAME_HELI"}, {"a": "FOUND_SCAFF", "b": "FRAME_ROPE"}, {"a": "FOUND_SCAFF", "b": "HAND_HELI"}, {"a": "FOUND_SCAFF", "b": "HAND_ROPE"}, {"a": "FOUND_SCAFF", "b": "ROOF_HELI"}, {"a": "FOUND_SCAFF", "b": "ROOF_ROPE"}, {"a": "FOUND_SCAFF", "b": "STAGE_HELI"}, {"a": "FOUND_SCAFF", "b": "STAGE_ROPE"}, {"a": "FOUND_SCAFF", "b": "TERR_HELI"}, {"a": "FOUND_SCAFF", "b": "TERR_ROPE"}, {"a": "FRAME_HELI", "b": "FRAME_ROPE"}, {"a": "FRAME_HELI", "b": "FRAME_SCAFF"}, {"a": "FRAME_HELI", "b": "HAND_ROPE"}, {"a": "FRAME_HELI", "b": "HAND_SCAFF"}, {"a": "FRAME_HELI", "b": "ROOF_ROPE"}, {"a": "FRAME_HELI", "b": "ROOF_SCAFF"}, {"a": "FRAME_HELI", "b": "STAGE_ROPE"}, {"a": "FRAME_HELI", "b": "STAGE_SCAFF"}, {"a": "FRAME_HELI", "b": "TERR_ROPE"}, {"a": "FRAME_HELI", "b": "TERR_SCAFF"}, {"a": "FRAME_ROPE", "b": "FRAME_SCAFF"}, {"a": "FRAME_ROPE", "b": "HAND_HELI"}, {"a": "FRAME_ROPE", "b": "HAND_SCAFF"}, {"a": "FRAME_ROPE", "b": "ROOF_HELI"}, {"a": "FRAME_ROPE", "b": "ROOF_SCAFF"}, {"a": "FRAME_ROPE", "b": "STAGE_HELI"}, {"a": "FRAME_ROPE", "b": "STAGE_SCAFF"}, {"a": "FRAME_ROPE", "b": "TERR_HELI"}, {"a": "FRAME_ROPE", "b": "TERR_SCAFF"}, {"a": "FRAME_SCAFF", "b": "HAND_HELI"}, {"a": "FRAME_SCAFF", "b": "HAND_ROPE"}, {"a": "FRAME_SCAFF", "b": "ROOF_HELI"}, {"a": "FRAME_SCAFF", "b": "ROOF_ROPE"}, {"a": "FRAME_SCAFF", "b": "STAGE_HELI"}, {"a": "FRAME_SCAFF", "b": "STAGE_ROPE"}, {"a": "FRAME_SCAFF", "b": "TERR_HELI"}, {"a": "FRAME_SCAFF", "b": "TERR_ROPE"}, {"a": "HAND_HELI", "b": "HAND_ROPE"}, {"a": "HAND_HELI", "b": "HAND_SCAFF"}, {"a": "HAND_HELI", "b": "ROOF_ROPE"}, {"a": "HAND_HELI", "b": "ROOF_SCAFF"}, {"a": "HAND_HELI", "b": "STAGE_ROPE"}, {"a": "HAND_HELI", "b": "STAGE_SCAFF"}, {"a": "HAND_HELI", "b": "TERR_ROPE"}, {"a": "HAND_HELI", "b": "TERR_SCAFF"}, {"a": "HAND_ROPE", "b": "HAND_SCAFF"}, {"a": "HAND_ROPE", "b": "ROOF_HELI"}, {"a": "HAND_ROPE", "b": "ROOF_SCAFF"}, {"a": "HAND_ROPE", "b": "STAGE_HELI"}, {"a": "HAND_ROPE", "b": "STAGE_SCAFF"}, {"a": "HAND_ROPE", "b": "TERR_HELI"}, {"a": "HAND_ROPE", "b": "TERR_SCAFF"}, {"a": "HAND_SCAFF", "b": "ROOF_HELI"}, {"a": "HAND_SCAFF", "b": "ROOF_ROPE"}, {"a": "HAND_SCAFF", "b": "STAGE_HELI"}, {"a": "HAND_SCAFF", "b": "STAGE_ROPE"}, {"a": "HAND_SCAFF", "b": "TERR_HELI"}, {"a": "HAND_SCAFF", "b": "TERR_ROPE"}, {"a": "ROOF_HELI", "b": "ROOF_ROPE"}, {"a": "ROOF_HELI", "b": "ROOF_SCAFF"}, {"a": "ROOF_HELI", "b": "STAGE_ROPE"}, {"a": "ROOF_HELI", "b": "STAGE_SCAFF"}, {"a": "ROOF_HELI", "b": "TERR_ROPE"}, {"a": "ROOF_HELI", "b": "TERR_SCAFF"}, {"a": "ROOF_ROPE", "b": "ROOF_SCAFF"}, {"a": "ROOF_ROPE", "b": "STAGE_HELI"}, {"a": "ROOF_ROPE", "b": "STAGE_SCAFF"}, {"a": "ROOF_ROPE", "b": "TERR_HELI"}, {"a": "ROOF_ROPE", "b": "TERR_SCAFF"}, {"a": "ROOF_SCAFF", "b": "STAGE_HELI"}, {"a": "ROOF_SCAFF", "b": "STAGE_ROPE"}, {"a": "ROOF_SCAFF", "b": "TERR_HELI"}, {"a": "ROOF_SCAFF", "b": "TERR_ROPE"}, {"a": "STAGE_HELI", "b": "STAGE_ROPE"}, {"a": "STAGE_HELI", "b": "STAGE_SCAFF"}, {"a": "STAGE_HELI", "b": "TERR_ROPE"}, {"a": "STAGE_HELI", "b": "TERR_SCAFF"}, {"a": "STAGE_ROPE", "b": "STAGE_SCAFF"}, {"a": "STAGE_ROPE", "b": "TERR_HELI"}, {"a": "STAGE_ROPE", "b": "TERR_SCAFF"}, {"a": "STAGE_SCAFF", "b": "TERR_HELI"}, {"a": "STAGE_SCAFF", "b": "TERR_ROPE"}, {"a": "TERR_HELI", "b": "TERR_ROPE"}, {"a": "TERR_HELI", "b": "TERR_SCAFF"}, {"a": "TERR_ROPE", "b": "TERR_SCAFF"}]}, "state_category": {"configs": [{"id": "S0", "size": 0, "commitment": "none", "events": [], "x": 80, "y": 60}, {"id": "S1", "size": 1, "commitment": "none", "events": ["PERM"], "x": 80, "y": 140}, {"id": "S2", "size": 1, "commitment": "none", "events": ["SAFETY"], "x": 140, "y": 140}, {"id": "S3", "size": 2, "commitment": "none", "events": ["PERM", "SAFETY"], "x": 80, "y": 220}, {"id": "S4", "size": 3, "commitment": "none", "events": ["PERM", "SAFETY", "SURV"], "x": 80, "y": 300}, {"id": "S5", "size": 4, "commitment": "heli", "events": ["ACC_HELI", "PERM", "SAFETY", "SURV"], "x": 400, "y": 380}, {"id": "S6", "size": 4, "commitment": "none", "events": ["DES", "PERM", "SAFETY", "SURV"], "x": 80, "y": 380}, {"id": "S7", "size": 4, "commitment": "rope", "events": ["ACC_ROPE", "PERM", "SAFETY", "SURV"], "x": 720, "y": 380}, {"id": "S8", "size": 4, "commitment": "scaff", "events": ["ACC_SCAFF", "PERM", "SAFETY", "SURV"], "x": 1040, "y": 380}, {"id": "S9", "size": 5, "commitment": "heli", "events": ["ACC_HELI", "DES", "PERM", "SAFETY", "SURV"], "x": 400, "y": 460}, {"id": "S10", "size": 5, "commitment": "none", "events": ["DES", "ORDER", "PERM", "SAFETY", "SURV"], "x": 80, "y": 460}, {"id": "S11", "size": 5, "commitment": "rope", "events": ["ACC_ROPE", "DES", "PERM", "SAFETY", "SURV"], "x": 720, "y": 460}, {"id": "S12", "size": 5, "commitment": "scaff", "events": ["ACC_SCAFF", "DES", "PERM", "SAFETY", "SURV"], "x": 1040, "y": 460}, {"id": "S13", "size": 6, "commitment": "heli", "events": ["ACC_HELI", "DES", "ORDER", "PERM", "SAFETY", "SURV"], "x": 400, "y": 540}, {"id": "S14", "size": 6, "commitment": "rope", "events": ["ACC_ROPE", "DES", "ORDER", "PERM", "SAFETY", "SURV"], "x": 720, "y": 540}, {"id": "S15", "size": 6, "commitment": "scaff", "events": ["ACC_SCAFF", "DES", "ORDER", "PERM", "SAFETY", "SURV"], "x": 1040, "y": 540}, {"id": "S16", "size": 7, "commitment": "heli", "events": ["ACC_HELI", "DES", "ORDER", "PERM", "SAFETY", "STAGE_HELI", "SURV"], "x": 400, "y": 620}, {"id": "S17", "size": 7, "commitment": "rope", "events": ["ACC_ROPE", "DES", "ORDER", "PERM", "SAFETY", "STAGE_ROPE", "SURV"], "x": 720, "y": 620}, {"id": "S18", "size": 7, "commitment": "scaff", "events": ["ACC_SCAFF", "DES", "ORDER", "PERM", "SAFETY", "STAGE_SCAFF", "SURV"], "x": 1040, "y": 620}, {"id": "S19", "size": 8, "commitment": "heli", "events": ["ACC_HELI", "DES", "ORDER", "PERM", "SAFETY", "STAGE_HELI", "SURV", "TERR_HELI"], "x": 400, "y": 700}, {"id": "S20", "size": 8, "commitment": "rope", "events": ["ACC_ROPE", "DES", "ORDER", "PERM", "SAFETY", "STAGE_ROPE", "SURV", "TERR_ROPE"], "x": 720, "y": 700}, {"id": "S21", "size": 8, "commitment": "scaff", "events": ["ACC_SCAFF", "DES", "ORDER", "PERM", "SAFETY", "STAGE_SCAFF", "SURV", "TERR_SCAFF"], "x": 1040, "y": 700}, {"id": "S22", "size": 9, "commitment": "heli", "events": ["ACC_HELI", "DES", "FOUND_HELI", "ORDER", "PERM", "SAFETY", "STAGE_HELI", "SURV", "TERR_HELI"], "x": 400, "y": 780}, {"id": "S23", "size": 9, "commitment": "rope", "events": ["ACC_ROPE", "DES", "FOUND_ROPE", "ORDER", "PERM", "SAFETY", "STAGE_ROPE", "SURV", "TERR_ROPE"], "x": 720, "y": 780}, {"id": "S24", "size": 9, "commitment": "scaff", "events": ["ACC_SCAFF", "DES", "FOUND_SCAFF", "ORDER", "PERM", "SAFETY", "STAGE_SCAFF", "SURV", "TERR_SCAFF"], "x": 1040, "y": 780}, {"id": "S25", "size": 10, "commitment": "heli", "events": ["ACC_HELI", "DES", "FOUND_HELI", "FRAME_HELI", "ORDER", "PERM", "SAFETY", "STAGE_HELI", "SURV", "TERR_HELI"], "x": 400, "y": 860}, {"id": "S26", "size": 10, "commitment": "rope", "events": ["ACC_ROPE", "DES", "FOUND_ROPE", "FRAME_ROPE", "ORDER", "PERM", "SAFETY", "STAGE_ROPE", "SURV", "TERR_ROPE"], "x": 720, "y": 860}, {"id": "S27", "size": 10, "commitment": "scaff", "events": ["ACC_SCAFF", "DES", "FOUND_SCAFF", "FRAME_SCAFF", "ORDER", "PERM", "SAFETY", "STAGE_SCAFF", "SURV", "TERR_SCAFF"], "x": 1040, "y": 860}, {"id": "S28", "size": 11, "commitment": "heli", "events": ["ACC_HELI", "DES", "FOUND_HELI", "FRAME_HELI", "ORDER", "PERM", "ROOF_HELI", "SAFETY", "STAGE_HELI", "SURV", "TERR_HELI"], "x": 400, "y": 940}, {"id": "S29", "size": 11, "commitment": "rope", "events": ["ACC_ROPE", "DES", "FOUND_ROPE", "FRAME_ROPE", "ORDER", "PERM", "ROOF_ROPE", "SAFETY", "STAGE_ROPE", "SURV", "TERR_ROPE"], "x": 720, "y": 940}, {"id": "S30", "size": 11, "commitment": "scaff", "events": ["ACC_SCAFF", "DES", "FOUND_SCAFF", "FRAME_SCAFF", "ORDER", "PERM", "ROOF_SCAFF", "SAFETY", "STAGE_SCAFF", "SURV", "TERR_SCAFF"], "x": 1040, "y": 940}, {"id": "S31", "size": 12, "commitment": "heli", "events": ["ACC_HELI", "CLAD_HELI", "DES", "FOUND_HELI", "FRAME_HELI", "ORDER", "PERM", "ROOF_HELI", "SAFETY", "STAGE_HELI", "SURV", "TERR_HELI"], "x": 400, "y": 1020}, {"id": "S32", "size": 12, "commitment": "rope", "events": ["ACC_ROPE", "CLAD_ROPE", "DES", "FOUND_ROPE", "FRAME_ROPE", "ORDER", "PERM", "ROOF_ROPE", "SAFETY", "STAGE_ROPE", "SURV", "TERR_ROPE"], "x": 720, "y": 1020}, {"id": "S33", "size": 12, "commitment": "scaff", "events": ["ACC_SCAFF", "CLAD_SCAFF", "DES", "FOUND_SCAFF", "FRAME_SCAFF", "ORDER", "PERM", "ROOF_SCAFF", "SAFETY", "STAGE_SCAFF", "SURV", "TERR_SCAFF"], "x": 1040, "y": 1020}, {"id": "S34", "size": 13, "commitment": "heli", "events": ["ACC_HELI", "CLAD_HELI", "DES", "FOUND_HELI", "FRAME_HELI", "HAND_HELI", "ORDER", "PERM", "ROOF_HELI", "SAFETY", "STAGE_HELI", "SURV", "TERR_HELI"], "x": 400, "y": 1100}, {"id": "S35", "size": 13, "commitment": "rope", "events": ["ACC_ROPE", "CLAD_ROPE", "DES", "FOUND_ROPE", "FRAME_ROPE", "HAND_ROPE", "ORDER", "PERM", "ROOF_ROPE", "SAFETY", "STAGE_ROPE", "SURV", "TERR_ROPE"], "x": 720, "y": 1100}, {"id": "S36", "size": 13, "commitment": "scaff", "events": ["ACC_SCAFF", "CLAD_SCAFF", "DES", "FOUND_SCAFF", "FRAME_SCAFF", "HAND_SCAFF", "ORDER", "PERM", "ROOF_SCAFF", "SAFETY", "STAGE_SCAFF", "SURV", "TERR_SCAFF"], "x": 1040, "y": 1100}], "step_edges": [{"source": "S0", "target": "S1", "event": "PERM"}, {"source": "S1", "target": "S3", "event": "SAFETY"}, {"source": "S3", "target": "S4", "event": "SURV"}, {"source": "S4", "target": "S6", "event": "DES"}, {"source": "S6", "target": "S10", "event": "ORDER"}, {"source": "S10", "target": "S14", "event": "ACC_ROPE"}, {"source": "S14", "target": "S17", "event": "STAGE_ROPE"}, {"source": "S17", "target": "S20", "event": "TERR_ROPE"}, {"source": "S20", "target": "S23", "event": "FOUND_ROPE"}, {"source": "S23", "target": "S26", "event": "FRAME_ROPE"}, {"source": "S26", "target": "S29", "event": "ROOF_ROPE"}, {"source": "S29", "target": "S32", "event": "CLAD_ROPE"}, {"source": "S32", "target": "S35", "event": "HAND_ROPE"}, {"source": "S10", "target": "S15", "event": "ACC_SCAFF"}, {"source": "S15", "target": "S18", "event": "STAGE_SCAFF"}, {"source": "S18", "target": "S21", "event": "TERR_SCAFF"}, {"source": "S21", "target": "S24", "event": "FOUND_SCAFF"}, {"source": "S24", "target": "S27", "event": "FRAME_SCAFF"}, {"source": "S27", "target": "S30", "event": "ROOF_SCAFF"}, {"source": "S30", "target": "S33", "event": "CLAD_SCAFF"}, {"source": "S33", "target": "S36", "event": "HAND_SCAFF"}, {"source": "S10", "target": "S13", "event": "ACC_HELI"}, {"source": "S13", "target": "S16", "event": "STAGE_HELI"}, {"source": "S16", "target": "S19", "event": "TERR_HELI"}, {"source": "S19", "target": "S22", "event": "FOUND_HELI"}, {"source": "S22", "target": "S25", "event": "FRAME_HELI"}, {"source": "S25", "target": "S28", "event": "ROOF_HELI"}, {"source": "S28", "target": "S31", "event": "CLAD_HELI"}, {"source": "S31", "target": "S34", "event": "HAND_HELI"}, {"source": "S6", "target": "S11", "event": "ACC_ROPE"}, {"source": "S11", "target": "S14", "event": "ORDER"}, {"source": "S6", "target": "S12", "event": "ACC_SCAFF"}, {"source": "S12", "target": "S15", "event": "ORDER"}, {"source": "S6", "target": "S9", "event": "ACC_HELI"}, {"source": "S9", "target": "S13", "event": "ORDER"}, {"source": "S4", "target": "S7", "event": "ACC_ROPE"}, {"source": "S7", "target": "S11", "event": "DES"}, {"source": "S4", "target": "S8", "event": "ACC_SCAFF"}, {"source": "S8", "target": "S12", "event": "DES"}, {"source": "S4", "target": "S5", "event": "ACC_HELI"}, {"source": "S5", "target": "S9", "event": "DES"}, {"source": "S0", "target": "S2", "event": "SAFETY"}, {"source": "S2", "target": "S3", "event": "PERM"}], "enabled_map": {"S0": ["PERM", "SAFETY"], "S1": ["SAFETY"], "S2": ["PERM"], "S3": ["SURV"], "S4": ["ACC_HELI", "ACC_ROPE", "ACC_SCAFF", "DES"], "S5": ["DES"], "S6": ["ACC_HELI", "ACC_ROPE", "ACC_SCAFF", "ORDER"], "S7": ["DES"], "S8": ["DES"], "S9": ["ORDER"], "S10": ["ACC_HELI", "ACC_ROPE", "ACC_SCAFF"], "S11": ["ORDER"], "S12": ["ORDER"], "S13": ["STAGE_HELI"], "S14": ["STAGE_ROPE"], "S15": ["STAGE_SCAFF"], "S16": ["TERR_HELI"], "S17": ["TERR_ROPE"], "S18": ["TERR_SCAFF"], "S19": ["FOUND_HELI"], "S20": ["FOUND_ROPE"], "S21": ["FOUND_SCAFF"], "S22": ["FRAME_HELI"], "S23": ["FRAME_ROPE"], "S24": ["FRAME_SCAFF"], "S25": ["ROOF_HELI"], "S26": ["ROOF_ROPE"], "S27": ["ROOF_SCAFF"], "S28": ["CLAD_HELI"], "S29": ["CLAD_ROPE"], "S30": ["CLAD_SCAFF"], "S31": ["HAND_HELI"], "S32": ["HAND_ROPE"], "S33": ["HAND_SCAFF"], "S34": [], "S35": [], "S36": []}}, "functors": {"F": {"PERM": "S1", "SAFETY": "S2", "SURV": "S4", "DES": "S6", "ORDER": "S10", "ACC_ROPE": "S7", "ACC_SCAFF": "S8", "ACC_HELI": "S5", "STAGE_ROPE": "S17", "TERR_ROPE": "S20", "FOUND_ROPE": "S23", "FRAME_ROPE": "S26", "ROOF_ROPE": "S29", "CLAD_ROPE": "S32", "HAND_ROPE": "S35", "STAGE_SCAFF": "S18", "TERR_SCAFF": "S21", "FOUND_SCAFF": "S24", "FRAME_SCAFF": "S27", "ROOF_SCAFF": "S30", "CLAD_SCAFF": "S33", "HAND_SCAFF": "S36", "STAGE_HELI": "S16", "TERR_HELI": "S19", "FOUND_HELI": "S22", "FRAME_HELI": "S25", "ROOF_HELI": "S28", "CLAD_HELI": "S31", "HAND_HELI": "S34"}, "G": {"PERM": {"from": "S0", "to": "S1"}, "SAFETY": {"from": "S0", "to": "S2"}, "SURV": {"from": "S3", "to": "S4"}, "DES": {"from": "S4", "to": "S6"}, "ORDER": {"from": "S6", "to": "S10"}, "ACC_ROPE": {"from": "S4", "to": "S7"}, "ACC_SCAFF": {"from": "S4", "to": "S8"}, "ACC_HELI": {"from": "S4", "to": "S5"}, "STAGE_ROPE": {"from": "S14", "to": "S17"}, "TERR_ROPE": {"from": "S17", "to": "S20"}, "FOUND_ROPE": {"from": "S20", "to": "S23"}, "FRAME_ROPE": {"from": "S23", "to": "S26"}, "ROOF_ROPE": {"from": "S26", "to": "S29"}, "CLAD_ROPE": {"from": "S29", "to": "S32"}, "HAND_ROPE": {"from": "S32", "to": "S35"}, "STAGE_SCAFF": {"from": "S15", "to": "S18"}, "TERR_SCAFF": {"from": "S18", "to": "S21"}, "FOUND_SCAFF": {"from": "S21", "to": "S24"}, "FRAME_SCAFF": {"from": "S24", "to": "S27"}, "ROOF_SCAFF": {"from": "S27", "to": "S30"}, "CLAD_SCAFF": {"from": "S30", "to": "S33"}, "HAND_SCAFF": {"from": "S33", "to": "S36"}, "STAGE_HELI": {"from": "S13", "to": "S16"}, "TERR_HELI": {"from": "S16", "to": "S19"}, "FOUND_HELI": {"from": "S19", "to": "S22"}, "FRAME_HELI": {"from": "S22", "to": "S25"}, "ROOF_HELI": {"from": "S25", "to": "S28"}, "CLAD_HELI": {"from": "S28", "to": "S31"}, "HAND_HELI": {"from": "S31", "to": "S34"}}}};

const EXPLAIN = {"new_vs_old": {"title": "What changed vs the previous (poset-only) app?", "body": "\n        <p><b>Previously</b> we modelled a project as a prerequisite <i>poset</i> (thin category) and took states to be <i>down-closed</i> sets of completed tasks (ideals). That captures ordering, but not <b>exclusive alternatives</b>.</p>\n        <p><b>Now</b> we add a <b>conflict relation</b> <code>#</code> to form a <b>prime event structure</b> <code>(E, \u2264, #)</code>. Conflict is how we encode \u201crope access <i>or</i> scaffold <i>or</i> helicopter\u201d, i.e. mutually exclusive plans.</p>\n        <p>The new state space is smaller and more meaningful: a state must be <b>down-closed</b> (prereqs satisfied) <i>and</i> <b>conflict-free</b> (no incompatible choices taken together). The right-hand graph is now a graph of <i>consistent histories</i>, not just scope-size.</p>\n        "}, "pes_101": {"title": "Prime event structure (E, \u2264, #) \u2014 the core idea", "body": "\n        <p>A <b>prime event structure</b> is a triple <code>(E, \u2264, #)</code>:</p>\n        <ul>\n          <li><b>E</b>: events (here: recognisable PM work packages/tasks).</li>\n          <li><b>\u2264</b>: causality / prerequisite (a partial order). If <code>a \u2264 b</code>, then <code>a</code> must happen before <code>b</code>.</li>\n          <li><b>#</b>: conflict (symmetric, irreflexive, hereditary). If <code>a # b</code>, they cannot both occur in any valid execution.</li>\n        </ul>\n        <p>Two events can be <b>concurrent</b> if neither causes the other and they are not in conflict. (E.g. \u201cPermissions\u201d and \u201cSafety plan\u201d can proceed in either order.)</p>\n        "}, "heredity": {"title": "Conflict heredity \u2014 why it models \u201ccommitment\u201d", "body": "\n        <p>The key axiom is <b>heredity</b> (upward closure):</p>\n        <p style=\"margin-left:1em\"><code>e # f</code> and <code>e \u2264 e'</code> \u21d2 <code>e' # f</code> (and symmetrically in the other argument).</p>\n        <p>Interpretation: if two high-level plans conflict (rope vs scaffold), then <b>everything built on top of one plan conflicts with the other plan</b>. So conflict propagates down a WBS refinement chain or down a dependency chain.</p>\n        <p>In this model we seed conflict only between the three access set-up events; the rest of the conflicts are the <b>hereditary closure</b> and are therefore \u201cimplied\u201d.</p>\n        "}, "config_def": {"title": "Configurations (states) = down-closed + conflict-free", "body": "\n        <p>A <b>configuration</b> is a subset <code>C \u2286 E</code> satisfying:</p>\n        <ol>\n          <li><b>Down-closed</b>: if <code>e \u2208 C</code> and <code>d \u2264 e</code>, then <code>d \u2208 C</code>.</li>\n          <li><b>Conflict-free</b>: there do not exist <code>e,f \u2208 C</code> with <code>e # f</code>.</li>\n        </ol>\n        <p>So a configuration is a <b>consistent history</b> of what has happened so far, including the <b>commitments</b> you have made (e.g., choosing rope access eliminates scaffold/heli futures).</p>\n        "}, "enabled": {"title": "Enabled events and the state-transition graph", "body": "\n        <p>Given a configuration <code>C</code>, an event <code>e</code> is <b>enabled</b> at <code>C</code> iff:</p>\n        <ul>\n          <li>All its causal predecessors are already in <code>C</code> (i.e. <code>\u2193e \\ {e} \u2286 C</code>), and</li>\n          <li><code>C</code> contains no event that conflicts with <code>e</code>.</li>\n        </ul>\n        <p>The right-hand graph draws <b>one-step transitions</b> <code>C \u2192 C\u222a{e}</code> for enabled events <code>e</code>. This is the \u201coperational\u201d view: what can happen next?</p>\n        "}, "commitments": {"title": "Decision commitments: why conflict feels like \u201cbranching scope\u201d", "body": "\n        <p>In ordinary precedence graphs, \u201cscope\u201d is often treated as an additive set. Event structures make the non-additivity explicit:</p>\n        <ul>\n          <li>Picking <b>rope access</b> is not just adding a task; it is a <b>commitment</b> that removes other futures.</li>\n          <li>This is encoded by conflict: once <code>ACC_ROPE</code> occurs, no event in the scaffold or helicopter branch can occur.</li>\n        </ul>\n        <p>In the state graph, nodes are colour-coded by the commitment so you can see where the branch is taken and how the future space collapses.</p>\n        "}, "joins": {"title": "Why \u201cjoins\u201d (OR prerequisites) are awkward in prime event structures", "body": "\n        <p>Prime event structures have <b>conjunctive causality</b>: if an event has multiple prerequisites, you need <i>all</i> of them.</p>\n        <p>But real projects often have <b>disjunctive</b> patterns: \u201cafter <i>either</i> rope staging <i>or</i> helicopter staging, do terrace prep\u201d. That\u2019s an <b>OR</b>-dependency.</p>\n        <p>To stay within the prime event structure formalism, a common move is <b>event splitting</b>: duplicate the downstream work per branch (as we do here with <code>\u2026_ROPE</code>, <code>\u2026_SCAFF</code>, <code>\u2026_HELI</code>).</p>\n        <p>If you want true merges without duplication, you typically move to richer models (e.g. <b>general/disjunctive event structures</b> or <b>Petri nets</b>).</p>\n        "}, "functors": {"title": "F and G still work under conflict (and why)", "body": "\n        <p>Even with conflict, we retain the same two canonical mappings (now into the configuration category):</p>\n        <ul>\n          <li><b>F</b>: maps an event <code>e</code> to its <b>principal configuration</b> <code>\u2193e</code> (the causal past plus itself). This is the minimal consistent state in which <code>e</code> is true.</li>\n          <li><b>G</b>: maps <code>e</code> to the <b>minimal step</b> <code>pre(e) \u2192 pre(e)\u222a{e}</code> (an object in <code>Arr(S)</code>), where <code>pre(e)=\u2193e\\{e}</code>.</li>\n        </ul>\n        <p>These are well-defined because for any event <code>e</code>, its causal past lies within one branch, hence is conflict-free.</p>\n        "}, "variation": {"title": "variation", "body": "\n        <p>If you want \u201cmerge without duplication\u201d next, the natural jump is from prime event structures to disjunctive event structures or Petri nets, then compare their configuration semantics via functors into a common domain/category of executions.</p>\n        "}, "how_to": {"title": "How to use this view (quick)", "body": "\n        <ul>\n          <li>Click an <b>event</b> (left): see its causal past, conflicts, and the corresponding <code>F(e)</code> state and <code>G(e)</code> transition highlighted on the right.</li>\n          <li>Click a <b>state</b> (right): see which events are completed, which are enabled next, and which branch/commitment you are in.</li>\n          <li>Toggle <b>Implied conflicts</b> only if you want a dense picture \u2014 it draws many dashed lines.</li>\n        </ul>\n        "}};

let state = {
  selectedEvent: null,
  selectedConfig: null,
  showImpliedConflicts: false,
  showEdgeLabels: true,
  showAllInclusions: false
};

function openExplain(key) {
  const m = EXPLAIN[key];
  document.getElementById('modalTitle').innerText = m.title;
  document.getElementById('modalBody').innerHTML = m.body;
  document.getElementById('modalOverlay').style.display = 'flex';
}
function closeModal() {
  document.getElementById('modalOverlay').style.display = 'none';
}
function closeModalIfBackdrop(ev) {
  // close if click on backdrop
  if (ev.target.id === 'modalOverlay') closeModal();
}

function q(sel) { return document.querySelector(sel); }
function qa(sel) { return Array.from(document.querySelectorAll(sel)); }

function classForEvent(ev) {
  const br = ev.branch;
  if (br === 'base') return 'base';
  if (br.startsWith('choice')) return 'choice';
  if (br === 'rope') return 'rope';
  if (br === 'scaff') return 'scaff';
  if (br === 'heli') return 'heli';
  return 'base';
}

function classForConfig(cfg) {
  return cfg.commitment || 'none';
}

function draw() {
  drawEvents();
  drawStates();
  writeInspectorIntro();
}

function drawEvents() {
  const svg = document.getElementById('svgEvents');
  const gEdges = document.getElementById('eventEdges');
  const gNodes = document.getElementById('eventNodes');
  const gConfBase = document.getElementById('conflictEdgesBase');
  const gConfImp = document.getElementById('conflictEdgesImplied');
  gEdges.innerHTML = '';
  gNodes.innerHTML = '';
  gConfBase.innerHTML = '';
  gConfImp.innerHTML = '';

  // causal edges
  for (const e of DATA.event_structure.causal_edges) {
    const s = DATA.event_structure.events.find(x => x.id===e.source);
    const t = DATA.event_structure.events.find(x => x.id===e.target);
    if (!s || !t) continue;
    const path = document.createElementNS('http://www.w3.org/2000/svg','path');
    // simple cubic for readability
    const x1=s.x, y1=s.y, x2=t.x, y2=t.y;
    const dx = Math.max(40, (x2-x1)*0.5);
    const d = `M ${x1} ${y1} C ${x1+dx} ${y1}, ${x2-dx} ${y2}, ${x2} ${y2}`;
    path.setAttribute('d', d);
    path.setAttribute('class','edge');
    path.setAttribute('marker-end','url(#arrow2)');
    path.dataset.source = e.source;
    path.dataset.target = e.target;
    gEdges.appendChild(path);
  }

  // conflict edges (base)
  for (const ce of DATA.event_structure.conflict_edges_base) {
    const a = DATA.event_structure.events.find(x=>x.id===ce.a);
    const b = DATA.event_structure.events.find(x=>x.id===ce.b);
    if (!a || !b) continue;
    const line = document.createElementNS('http://www.w3.org/2000/svg','line');
    line.setAttribute('x1', a.x); line.setAttribute('y1', a.y);
    line.setAttribute('x2', b.x); line.setAttribute('y2', b.y);
    line.setAttribute('class', 'conflictEdge');
    line.dataset.a = ce.a; line.dataset.b = ce.b;
    gConfBase.appendChild(line);
  }

  // implied conflicts (dense) - hidden by default
  for (const ce of DATA.event_structure.conflict_edges_full) {
    // skip base ones (already drawn) by checking if both are access choice events
    // We'll still draw them; it's okay; they overlap.
    const a = DATA.event_structure.events.find(x=>x.id===ce.a);
    const b = DATA.event_structure.events.find(x=>x.id===ce.b);
    if (!a || !b) continue;
    const line = document.createElementNS('http://www.w3.org/2000/svg','line');
    line.setAttribute('x1', a.x); line.setAttribute('y1', a.y);
    line.setAttribute('x2', b.x); line.setAttribute('y2', b.y);
    line.setAttribute('class', 'conflictEdge implied');
    line.dataset.a = ce.a; line.dataset.b = ce.b;
    gConfImp.appendChild(line);
  }

  // nodes
  for (const ev of DATA.event_structure.events) {
    const g = document.createElementNS('http://www.w3.org/2000/svg','g');
    g.setAttribute('class', `node ${classForEvent(ev)}`);
    g.setAttribute('transform', `translate(${ev.x},${ev.y})`);
    g.dataset.id = ev.id;
    g.addEventListener('click', () => selectEvent(ev.id));

    const c = document.createElementNS('http://www.w3.org/2000/svg','circle');
    c.setAttribute('r', 18);
    g.appendChild(c);

    const t = document.createElementNS('http://www.w3.org/2000/svg','text');
    t.setAttribute('x', 26);
    t.setAttribute('y', -4);
    t.textContent = ev.id;
    g.appendChild(t);

    const t2 = document.createElementNS('http://www.w3.org/2000/svg','text');
    t2.setAttribute('x', 26);
    t2.setAttribute('y', 12);
    t2.setAttribute('class','sub');
    t2.textContent = ev.name;
    g.appendChild(t2);

    gNodes.appendChild(g);
  }
}

function drawStates() {
  const gEdges = document.getElementById('stateEdges');
  const gAll = document.getElementById('stateEdgesAll');
  const gLabels = document.getElementById('stateEdgeLabels');
  const gNodes = document.getElementById('stateNodes');
  gEdges.innerHTML = '';
  gAll.innerHTML = '';
  gLabels.innerHTML = '';
  gNodes.innerHTML = '';

  // cover edges (step edges)
  for (const e of DATA.state_category.step_edges) {
    const s = DATA.state_category.configs.find(x => x.id===e.source);
    const t = DATA.state_category.configs.find(x => x.id===e.target);
    if (!s || !t) continue;
    const path = document.createElementNS('http://www.w3.org/2000/svg','path');
    const x1=s.x, y1=s.y, x2=t.x, y2=t.y;
    const dx = (x2-x1) * 0.3;
    const d = `M ${x1} ${y1} C ${x1+dx} ${y1}, ${x2-dx} ${y2}, ${x2} ${y2}`;
    path.setAttribute('d', d);
    path.setAttribute('class','edgeG');
    path.dataset.source = e.source;
    path.dataset.target = e.target;
    path.dataset.event = e.event;
    gEdges.appendChild(path);

    // label
    const lbl = document.createElementNS('http://www.w3.org/2000/svg','text');
    lbl.setAttribute('class','edgeLabel');
    lbl.dataset.for = `${e.source}>${e.target}`;
    const midx=(x1+x2)/2 + 8;
    const midy=(y1+y2)/2 - 8;
    lbl.setAttribute('x', midx);
    lbl.setAttribute('y', midy);
    lbl.textContent = e.event;
    gLabels.appendChild(lbl);
  }

  // all inclusions (transitive closure) computed on the fly when toggled
  // We'll build once and keep hidden unless needed.
  if (state.showAllInclusions) {
    buildAllInclusions();
  }

  // nodes
  for (const cfg of DATA.state_category.configs) {
    const g = document.createElementNS('http://www.w3.org/2000/svg','g');
    g.setAttribute('class', `node stateNode ${classForConfig(cfg)}`);
    g.setAttribute('transform', `translate(${cfg.x},${cfg.y})`);
    g.dataset.id = cfg.id;
    g.addEventListener('click', () => selectConfig(cfg.id));

    const c = document.createElementNS('http://www.w3.org/2000/svg','circle');
    c.setAttribute('r', 16);
    g.appendChild(c);

    const t = document.createElementNS('http://www.w3.org/2000/svg','text');
    t.setAttribute('x', -10);
    t.setAttribute('y', 1);
    t.textContent = cfg.id;
    g.appendChild(t);

    gNodes.appendChild(g);
  }
}

function buildAllInclusions() {
  // Build dashed inclusion edges for every pair I⊂J (excluding cover edges), within current config set.
  // This can be dense; we draw faint dashed lines.
  const gAll = document.getElementById('stateEdgesAll');
  gAll.innerHTML = '';
  const cfgs = DATA.state_category.configs;
  const setMap = new Map(cfgs.map(c => [c.id, new Set(c.events)]));
  // quick lookup cover edges to avoid drawing duplicates
  const cover = new Set(DATA.state_category.step_edges.map(e => `${e.source}>${e.target}`));
  for (let i=0; i<cfgs.length; i++) {
    for (let j=0; j<cfgs.length; j++) {
      if (i===j) continue;
      const A = cfgs[i], B = cfgs[j];
      if (A.size >= B.size) continue;
      const key = `${A.id}>${B.id}`;
      if (cover.has(key)) continue;
      // check subset
      const SA = setMap.get(A.id);
      const SB = setMap.get(B.id);
      let ok=true;
      for (const x of SA) if (!SB.has(x)) { ok=false; break; }
      if (!ok) continue;
      const path = document.createElementNS('http://www.w3.org/2000/svg','path');
      const x1=A.x, y1=A.y, x2=B.x, y2=B.y;
      const dx = (x2-x1)*0.3;
      const d = `M ${x1} ${y1} C ${x1+dx} ${y1}, ${x2-dx} ${y2}, ${x2} ${y2}`;
      path.setAttribute('d', d);
      path.setAttribute('class','edgeG dim');
      path.style.strokeDasharray = '3 7';
      path.style.opacity = '0.10';
      gAll.appendChild(path);
    }
  }
}

function toggleEdgeLabels() {
  state.showEdgeLabels = !state.showEdgeLabels;
  document.getElementById('btnLabels').innerText = `Edge labels: ${state.showEdgeLabels ? 'ON' : 'OFF'}`;
  document.getElementById('stateEdgeLabels').style.display = state.showEdgeLabels ? 'block' : 'none';
}

function toggleAllInclusions() {
  state.showAllInclusions = !state.showAllInclusions;
  document.getElementById('btnShowAllMorph').innerText = `All inclusions: ${state.showAllInclusions ? 'ON' : 'OFF'}`;
  document.getElementById('stateEdgesAll').style.display = state.showAllInclusions ? 'block' : 'none';
  if (state.showAllInclusions) {
    buildAllInclusions();
  }
}

function toggleImpliedConflicts() {
  state.showImpliedConflicts = !state.showImpliedConflicts;
  const g = document.getElementById('conflictEdgesImplied');
  g.style.display = state.showImpliedConflicts ? 'block' : 'none';
  document.getElementById('btnImplied').innerText = `Implied conflicts: ${state.showImpliedConflicts ? 'ON' : 'OFF'}`;
  document.getElementById('btnImplied').classList.toggle('toggle-on', state.showImpliedConflicts);
}

function clearSelection() {
  state.selectedEvent = null;
  state.selectedConfig = null;
  clearHighlights();
  writeInspectorIntro();
}

function clearHighlights() {
  // clear classes
  qa('#svgEvents .node').forEach(n => n.classList.remove('selected','past','conflict','dim','inState','enabled'));
  qa('#svgEvents .edge').forEach(e => e.classList.remove('highlight','dim'));
  qa('#svgStates .stateNode').forEach(n => n.classList.remove('selected','Ftarget','dim','enableTarget'));
  qa('#svgStates .edgeG').forEach(e => e.classList.remove('highlight','dim'));
  qa('#svgStates .edgeLabel').forEach(l => l.classList.remove('hidden'));
  if (!state.showEdgeLabels) qa('#svgStates .edgeLabel').forEach(l => l.classList.add('hidden'));
}

function selectEvent(eid) {
  state.selectedEvent = eid;
  state.selectedConfig = null;
  clearHighlights();

  const ev = DATA.event_structure.events.find(x => x.id===eid);
  if (!ev) return;
  const past = new Set(ev.ancestors);
  const conf = new Set(ev.conflicts);

  // dim everything first
  qa('#svgEvents .node').forEach(n => n.classList.add('dim'));
  qa('#svgStates .stateNode').forEach(n => n.classList.add('dim'));
  qa('#svgStates .edgeG').forEach(e => e.classList.add('dim'));
  qa('#svgEvents .edge').forEach(e => e.classList.add('dim'));

  // highlight selected + past + conflicts
  const node = q(`#svgEvents .node[data-id="${eid}"]`);
  if (node) {
    node.classList.remove('dim');
    node.classList.add('selected');
  }
  for (const p of past) {
    const pn = q(`#svgEvents .node[data-id="${p}"]`);
    if (pn) {
      pn.classList.remove('dim');
      pn.classList.add('past');
    }
    // highlight causal edges p -> ...
  }
  for (const c of conf) {
    const cn = q(`#svgEvents .node[data-id="${c}"]`);
    if (cn) {
      cn.classList.remove('dim');
      cn.classList.add('conflict');
    }
  }

  // highlight causal edges among past to selected (direct prereq edges)
  for (const edge of qa('#svgEvents .edge')) {
    const s=edge.dataset.source, t=edge.dataset.target;
    if (t===eid && past.has(s)) {
      edge.classList.remove('dim');
      edge.classList.add('highlight');
    }
  }

  // highlight F(e) node in state graph
  const F = DATA.functors.F[eid];
  if (F) {
    const sn = q(`#svgStates .stateNode[data-id="${F}"]`);
    if (sn) {
      sn.classList.remove('dim');
      sn.classList.add('Ftarget');
    }
  }

  // highlight G(e) minimal step edge
  const G = DATA.functors.G[eid];
  if (G) {
    const from = G.from, to = G.to;
    const edge = q(`#svgStates .edgeG[data-source="${from}"][data-target="${to}"][data-event="${eid}"]`);
    if (edge) {
      edge.classList.remove('dim');
      edge.classList.add('highlight');
    }
    const fn = q(`#svgStates .stateNode[data-id="${from}"]`);
    const tn = q(`#svgStates .stateNode[data-id="${to}"]`);
    if (fn) fn.classList.remove('dim');
    if (tn) tn.classList.remove('dim');
  }

  // optionally highlight all states that enable eid
  for (const cfg of DATA.state_category.configs) {
    const enabled = DATA.state_category.enabled_map[cfg.id] || [];
    if (enabled.includes(eid)) {
      const cn = q(`#svgStates .stateNode[data-id="${cfg.id}"]`);
      if (cn) {
        cn.classList.remove('dim');
        cn.classList.add('enableTarget');
      }
    }
  }

  writeEventInspector(ev);
}

function selectConfig(cid) {
  state.selectedConfig = cid;
  state.selectedEvent = null;
  clearHighlights();

  const cfg = DATA.state_category.configs.find(x => x.id===cid);
  if (!cfg) return;

  // dim everything
  qa('#svgEvents .node').forEach(n => n.classList.add('dim'));
  qa('#svgEvents .edge').forEach(e => e.classList.add('dim'));
  qa('#svgStates .stateNode').forEach(n => n.classList.add('dim'));
  qa('#svgStates .edgeG').forEach(e => e.classList.add('dim'));

  // highlight selected state
  const sn = q(`#svgStates .stateNode[data-id="${cid}"]`);
  if (sn) {
    sn.classList.remove('dim');
    sn.classList.add('selected');
  }

  const eventsIn = new Set(cfg.events);
  const enabled = new Set(DATA.state_category.enabled_map[cid] || []);

  // highlight events in configuration
  for (const eid of eventsIn) {
    const en = q(`#svgEvents .node[data-id="${eid}"]`);
    if (en) {
      en.classList.remove('dim');
      en.classList.add('inState');
    }
  }
  // highlight enabled events
  for (const eid of enabled) {
    const en = q(`#svgEvents .node[data-id="${eid}"]`);
    if (en) {
      en.classList.remove('dim');
      en.classList.add('enabled');
    }
  }

  // highlight outgoing edges from this state
  for (const edge of qa('#svgStates .edgeG')) {
    if (edge.dataset.source === cid) {
      edge.classList.remove('dim');
      edge.classList.add('highlight');
      // also show target node
      const tn = q(`#svgStates .stateNode[data-id="${edge.dataset.target}"]`);
      if (tn) tn.classList.remove('dim');
    }
  }

  // show causal edges among events in config (optional: show edges to enabled next)
  for (const edge of qa('#svgEvents .edge')) {
    const s=edge.dataset.source, t=edge.dataset.target;
    if (eventsIn.has(s) && eventsIn.has(t)) {
      edge.classList.remove('dim');
      edge.classList.add('highlight');
    }
  }

  writeConfigInspector(cfg, enabled);
}

function writeInspectorIntro() {
  const el = document.getElementById('inspector');
  el.innerHTML = `
    <h3>Inspector</h3>
    <div class="muted">Click an event or a state. This app is focused on the <b>new idea</b>: modelling mutually exclusive alternatives via <b>conflict (#)</b> and viewing states as <b>consistent histories</b> (configurations).</div>
    <div style="margin-top:10px;" class="muted">
      Try: click <span class="pill">ACC_ROPE</span> (or scaffold/helicopter) and watch how it picks out a branch in the configuration graph.
    </div>
  `;
}

function pill(commit) {
  return `<span class="pill ${commit}">${commit}</span>`;
}

function writeEventInspector(ev) {
  const el = document.getElementById('inspector');
  const F = DATA.functors.F[ev.id];
  const G = DATA.functors.G[ev.id];
  const commit = (ev.branch==='rope') ? 'rope' : (ev.branch==='scaff' ? 'scaff' : (ev.branch==='heli' ? 'heli' : (ev.branch.startsWith('choice_') ? ev.branch.split('_')[1] : 'none')));
  const prereq = ev.prereq || [];
  const past = ev.ancestors || [];
  const conflicts = ev.conflicts || [];
  const conflictSummary = conflicts.length>0 ? `${conflicts.length} event(s) (mostly the other access branches, by heredity)` : `0`;
  const Gtxt = G ? `${G.from} → ${G.to} (adds <b>${ev.id}</b>)` : '—';
  el.innerHTML = `
    <h3>Selected event: <span class="pill">${ev.id}</span> ${pill(commit)}</h3>
    <div class="muted">${ev.desc}</div>
    <div style="margin-top:10px;" class="grid2">
      <div class="kv"><b>Direct prerequisites:</b><br>${prereq.length? prereq.map(x=>`<span class="pill">${x}</span>`).join(' ') : 'none'}</div>
      <div class="kv"><b>Causal past (↓e \ {'id': 'HAND_HELI', 'name': 'Final inspection & handover (helicopter lift)', 'desc': 'Final safety/quality inspection, tidy site, remove temporary works where applicable, handover and documentation.', 'prereq': ['CLAD_HELI'], 'branch': 'heli'}):</b><br>${past.length? past.map(x=>`<span class="pill">${x}</span>`).join(' ') : '∅'}</div>
      <div class="kv"><b>Conflict set size:</b><br>${conflictSummary}</div>
      <div class="kv"><b>F(e): principal configuration</b><br><span class="pill">${F}</span></div>
      <div class="kv"><b>G(e): minimal step in Arr(S)</b><br>${Gtxt}</div>
      <div class="kv"><b>Interpretation:</b><br>
        Completing <span class="pill">${ev.id}</span> is compatible with exactly one access branch; conflict makes that “commitment” explicit.
      </div>
    </div>
    <div style="margin-top:10px;" class="muted">
      Tip: if you turn on <b>Implied conflicts</b>, you'll see the hereditary closure drawn explicitly (dense).
    </div>
  `;
}

function writeConfigInspector(cfg, enabledSet) {
  const el = document.getElementById('inspector');
  const commit = cfg.commitment || 'none';
  const events = cfg.events || [];
  const enabled = Array.from(enabledSet || []);
  el.innerHTML = `
    <h3>Selected state: <span class="pill">${cfg.id}</span> ${pill(commit)} <span class="pill">|C|=${cfg.size}</span></h3>
    <div class="muted">
      This node is a <b>configuration</b>: a down‑closed, conflict‑free history. Its colour shows the current commitment (if any) to an access method.
    </div>
    <div style="margin-top:10px;" class="grid2">
      <div class="kv"><b>Events completed (C):</b><br>${events.length? events.map(x=>`<span class="pill">${x}</span>`).join(' ') : '∅'}</div>
      <div class="kv"><b>Enabled next events:</b><br>${enabled.length? enabled.map(x=>`<span class="pill">${x}</span>`).join(' ') : '(none — terminal state for this branch)'} </div>
      <div class="kv"><b>Meaning:</b><br>
        If commitment is <b>none</b>, the plan is still open (you can choose rope/scaffold/helicopter). Once an access event occurs, the other branches become impossible.
      </div>
      <div class="kv"><b>Category view:</b><br>
        Morphisms are inclusions <code>C ⊆ C'</code>. The drawn arrows are the <i>covers</i> <code>C → C∪{e}</code>.
      </div>
    </div>
  `;
}

function downloadJSON() {
  const blob = new Blob([JSON.stringify(DATA, null, 2)], {type: 'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'cliff_shed_event_structure_data.json';
  document.body.appendChild(a);
  a.click();
  a.remove();
  URL.revokeObjectURL(url);
}

draw();
</script>
</body>
</html>
